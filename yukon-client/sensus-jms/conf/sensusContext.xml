<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>
  <!-- Pooled Connection Factory -->
  <bean id="sensusJmsFactoryPool" class="org.apache.activemq.pool.PooledConnectionFactory">
    <property name="connectionFactory" ref="sensusJmsFactory"/>
  </bean>

  <bean id="sensusJmsFactory" class="org.apache.activemq.ActiveMQConnectionFactory">
    <property name="brokerURL">
      <value>failover:tcp://s1.139.usamr.amdswireless.com:61616</value>
    </property>
  </bean>

  <bean id="sensusMain" class="com.cannontech.sensus.SensusMain">
    <property name="factory" ref="sensusJmsFactory"/>
    <property name="destination" ref="destination"/>
    <property name="messageListener" ref="sensusMessageListener"/>
    <property name="messageSelector">
      <value>RepId IS NOT NULL and AppCode IS NOT NULL</value>
    </property>
  </bean>

  <!-- this is the Message Driven POJO (MDP) -->
  <bean id="sensusMessageListener" class="com.cannontech.sensus.SensusMessageListener">
    <property name="sensusMessageHandlerSet">
        <set>
        	<ref bean="faultDetectProcessor" />
<!--        	<ref bean="setupMessageProcessor" />  -->
	    </set>
  </property>
  </bean>
  
  <bean id="destination" class="org.apache.activemq.command.ActiveMQTopic">
    <!-- Set the Destination Name -->
    <constructor-arg index="0">
       <value>AMDS-OBJ</value>
    </constructor-arg>
  </bean>


<!-- and this is the message listener container -->
  <bean id="listenerContainer" 
	 class="org.springframework.jms.listener.DefaultMessageListenerContainer">
    <property name="destination" ref="destination" />
    <property name="concurrentConsumers" value="1"/>
    <property name="connectionFactory" ref="sensusJmsFactory" />
    <property name="messageListener" ref="sensusMessageListener" />
  </bean>
  
  <bean id="oneDeviceLookup" class="com.cannontech.sensus.OneDeviceForAllLookup">
    <property name="deviceName" value="SensusTest1"/>
    <property name="deviceDao" ref="deviceDao"/>
  </bean>
  
  <bean id="deviceLookup" class="com.cannontech.sensus.ConfigurableDeviceLookup">
    <property name="deviceDao" ref="deviceDao"/>
    <property name="deviceMapping">
      <map>
        <!-- Put your device mappings here.  repId to yukon device name  -->
      </map>
    </property>
  </bean>
  
  <bean id="deviceIdLookup" class="com.cannontech.sensus.ConfigurablePaoLookup">
    <property name="paoDao" ref="paoDao"/>
    <property name="paoMapping">
      <map>
        <entry key="1" value="3"/>
        <!-- Put your device mappings here.  repId to yukon device name  -->
      </map>
    </property>
  </bean>
  
  <bean id="faultDetectProcessor" class="com.cannontech.sensus.FaultDetectProcessor">
      <property name="messageEncoder"><bean class="com.amdswireless.common.MessageEncoder"/></property>
      <property name="yukonDeviceLookup" ref="deviceIdLookup"/>
      <property name="bindingKeyRegEx" value="^CPS.*"/>
      <property name="ignoreEventBit" value="true"/>
      <property name="faultGenerator" ref="faultStatusGenerator"/>
      <property name="latGenerator" ref="latitudeGenerator"/>
      <property name="longGenerator" ref="longitudeGenerator"/>
      <property name="batteryVoltageGenerator" ref="batteryVoltageGenerator"/>
      <property name="no60Generator" ref="no60HzUnderGenerator"/>
      <property name="deviceTemperatureGenerator" ref="deviceTemperatureGenerator"/>
      <property name="batteryLowGenerator" ref="batteryLowGenerator"/>
      <property name="faultLatchGenerator" ref="nullPointDataGenerator"/>
      <property name="tgbIdGenerator" ref="tgbIdGenerator"/>
      <property name="sigStrengthGenerator" ref="sigStrengthGenerator"/>
      <property name="nameOfAppInstance" value="AppCode"/>
      <property name="handlerTimeZone" value="UTC"/>
  </bean>

  <bean id="nullPointDataGenerator" class="com.cannontech.sensus.NullPointValueUpdater"/>

  <bean id="abstractPointDataGenerator" class="com.cannontech.sensus.PointDataGenerator" abstract="true">
    <property name="dispatchConnection" ref="dispatchConnection"/>
    <property name="pointDao" ref="pointDao"/>
    <property name="cachePoints" value="false"/>
  </bean>
  
  <bean id="faultStatusGenerator" parent="abstractPointDataGenerator">
    <property name="offset" value="1"/>
    <property name="type" value="0"/> <!-- Status -->
  </bean>
  
  <bean id="latitudeGenerator" parent="abstractPointDataGenerator">
    <property name="offset" value="1"/>
    <property name="type" value="1"/>  <!-- Analog -->
  </bean>
  
  <bean id="longitudeGenerator" parent="abstractPointDataGenerator">
    <property name="offset" value="2"/>
    <property name="type" value="1"/>  <!-- Analog -->
  </bean>
  
  <bean id="no60HzUnderGenerator" parent="abstractPointDataGenerator">
    <property name="offset" value="2"/>
    <property name="type" value="0"/>  <!-- Status -->
  </bean>
  
  <bean id="batteryVoltageGenerator" parent="abstractPointDataGenerator">
    <property name="offset" value="3"/>
    <property name="type" value="1"/>  <!-- Analog -->
  </bean>
  
  <bean id="deviceTemperatureGenerator" parent="abstractPointDataGenerator">
    <property name="offset" value="4"/>
    <property name="type" value="1"/>  <!-- Analog -->
  </bean>
  
  <bean id="batteryLowGenerator" parent="abstractPointDataGenerator">
    <property name="offset" value="4"/>
    <property name="type" value="0"/>  <!-- Status -->
  </bean>

  <bean id="faultLatchGenerator" parent="abstractPointDataGenerator">
    <property name="offset" value="99"/>
    <property name="type" value="0"/>  <!-- Status -->
  </bean>

  <bean id="tgbIdGenerator" parent="abstractPointDataGenerator">
    <property name="offset" value="10"/>
    <property name="type" value="0"/>  <!-- Status -->
  </bean>

  <bean id="sigStrengthGenerator" parent="abstractPointDataGenerator">
    <property name="offset" value="11"/>
    <property name="type" value="0"/>  <!-- Status -->
  </bean>

</beans>
