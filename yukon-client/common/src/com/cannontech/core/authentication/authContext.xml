<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>
    <bean id="authenticationService" class="com.cannontech.core.authentication.service.impl.AuthenticationServiceImpl">
      <property name="providerMap">
        <map>
          <entry key="PLAIN" value-ref="localPlainAuthentication"/>
          <entry key="HASH_SHA" value-ref="localShaAuthentication"/>
          <entry key="RADIUS" value-ref="radiusLoginProvider"/>
          <entry key="NONE" value-ref="nullAuthentication"/>
          <entry key="AD" value-ref="ADAuthentication"/>
          <entry key="LDAP" value-ref="ldapAuthentication"/>
        </map>
      </property>
      <property name="yukonUserDao" ref="yukonUserDao"/>
    </bean>
    
    <bean id="yukonUserPasswordDao" class="com.cannontech.core.authentication.dao.impl.YukonUserPasswordDaoImpl">
      <property name="template" ref="simpleJdbcTemplate"/>
    </bean>
    
    <bean id="localPlainAuthentication" class="com.cannontech.core.authentication.service.impl.LocalPlainAuthenticationService">
      <property name="yukonUserPasswordDao" ref="yukonUserPasswordDao"/>
    </bean>
    
    <bean id="localShaAuthentication" class="com.cannontech.core.authentication.service.impl.LocalHashAuthenticationService">
      <property name="yukonUserPasswordDao" ref="yukonUserPasswordDao"/>
      <property name="passwordHasher">
        <bean class="com.cannontech.core.authentication.service.impl.MessageDigestHasher">
          <constructor-arg value="SHA"/>
        </bean>
      </property>
    </bean>
    
    <!--  Allow startup when radius library is missing by using a proxy bean -->
    <bean id="radiusLoginProvider" class="org.springframework.aop.framework.ProxyFactoryBean">
      <property name="targetSource">
        <bean class="org.springframework.aop.target.LazyInitTargetSource">
           <property name="targetBeanName"><idref local="radiusLoginProviderTarget"/></property>
        </bean>
      </property>
    </bean>
     
     <bean id="radiusLoginProviderTarget" class="com.cannontech.common.login.radius.RadiusLogin" lazy-init="true">
      <property name="roleDao" ref="roleDao"/>
    </bean>
    
    <bean id="nullAuthentication" class="com.cannontech.core.authentication.service.impl.NullAuthenticationService">
    </bean>
    
    <bean id="ldapService" class="com.cannontech.common.login.ldap.LDAPService"/>
    
    <bean id="ADAuthentication" class="com.cannontech.common.login.ldap.impl.LDAPADLogin">
    	<property name="roleDao" ref="roleDao"/>
    	<property name="ldapService" ref="ldapService"/>
    </bean>
    
    <bean id="ldapAuthentication" class="com.cannontech.common.login.ldap.impl.LDAPX500Login">
    	<property name="roleDao" ref="roleDao"/>
    	<property name="ldapService" ref="ldapService"/>
    </bean>
    
</beans>

