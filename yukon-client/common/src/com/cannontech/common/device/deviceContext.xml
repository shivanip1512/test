<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
       http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
       http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd">
	
    <bean id="commandRequestExecutorBase" abstract="true">
        <property name="porterConnection" ref="porterConnection" />
        <property name="deviceErrorTranslatorDao" ref="deviceErrorTranslator" />
        <property name="commandPermissionConverter" ref="permissionConverter" />
        <property name="loggableCommandPermissions">
            <set>
                <value>CONTROL_COMMAND</value>
                <value>WRITE_COMMAND</value>
            </set>
        </property>
    </bean>
    
	<bean id="commandRequestDeviceExecutor" parent="commandRequestExecutorBase" class="com.cannontech.common.device.commands.impl.CommandRequestDeviceExecutorImpl">
    </bean>
    
    <bean id="commandRequestRouteExecutor" parent="commandRequestExecutorBase" class="com.cannontech.common.device.commands.impl.CommandRequestRouteExecutorImpl">
    </bean>

    <bean id="commandRequestRouteAndDeviceExecutor" parent="commandRequestExecutorBase" class="com.cannontech.common.device.commands.impl.CommandRequestRouteAndDeviceExecutorImpl">
    </bean>
    
    <bean id="attributeService" class="com.cannontech.common.device.attribute.service.AttributeServiceImpl" scope="singleton">
        <property name="dbPersistentDao" ref="dbPersistentDao" />
        <property name="deviceDefinitionDao" ref="deviceDefinitionDao" />
        <property name="pointService" ref="devicePointService" />
        <property name="pointDao" ref="pointDao"/>
    </bean>
    
    <bean id="devicePointService" class="com.cannontech.common.device.service.PointServiceImpl" scope="singleton">
        <property name="pointDao" ref="pointDao" />
        <property name="nextValueHelper" ref="nextValueHelper" />
    </bean>
    
    <bean id="deviceUpdateService" class="com.cannontech.common.device.service.DeviceUpdateServiceImpl" scope="singleton">
        <property name="deviceDao" ref="deviceDao" />
        <property name="paoDao" ref="paoDao" />
        <property name="routeDiscoveryService" ref="routeDiscoveryService"/>
    </bean>
    
    <bean id="routeDiscoveryService" class="com.cannontech.common.device.service.RouteDiscoveryServiceImpl" scope="singleton">
        <property name="commandRequestRouteAndDeviceExecutor" ref="commandRequestRouteAndDeviceExecutor" />
        <property name="scheduledExecutor" ref="globalScheduledExecutor" />
        <property name="paoDao" ref="paoDao" />
        
    </bean>
    
    <bean id="simpleDeviceService" class="com.cannontech.common.device.definition.service.SimpleDeviceDefinitionServiceImpl" scope="singleton">
        <property name="deviceDefinitionDao" ref="deviceDefinitionDao" />
        <property name="pointService" ref="devicePointService" />
        <property name="pointDao" ref="pointDao" />
    </bean>
    
    <bean id="deviceService" class="com.cannontech.common.device.definition.service.DeviceDefinitionServiceImpl" scope="singleton">
        <property name="simpleDeviceDefinitionService" ref="simpleDeviceService" />
        <property name="pointService" ref="devicePointService" />
        <property name="attributeService" ref="attributeService" />
        <property name="paoGroupsWrapper" ref="paoGroupsWrapper" />
        <property name="dbPersistentDao" ref="dbPersistentDao" />
    </bean>
    
	<bean id="deviceDefinitionDao" class="com.cannontech.common.device.definition.dao.DeviceDefinitionDaoImpl" scope="singleton" init-method="initialize">
        <property name="inputFile" value="classpath:com/cannontech/common/device/definition/dao/deviceDefinition.xml" />
        <property name="schemaFile" value="classpath:com/cannontech/common/device/definition/dao/deviceDefinition.xsd" />
        <property name="pointLegendFile" value="classpath:com/cannontech/common/device/definition/dao/pointOffset.xsl" />
        <property name="javaConstantClassName" value="com.cannontech.database.data.pao.DeviceTypes" />
        <property name="paoGroupsWrapper" ref="paoGroupsWrapper" />
        <property name="unitMeasureDao" ref="unitMeasureDao" />
        <property name="stateDao" ref="stateDao" />
    </bean>
    
	<bean id="paoGroupsWrapper" class="com.cannontech.database.data.pao.PaoGroupsWrapperImpl" scope="singleton" />
    
    <bean id="attrDynamicDataSource" class="com.cannontech.common.device.attribute.service.AttributeDynamicDataSource" scope="singleton">
        <property name="dynamicDataSource" ref="dynamicDataSource"/>
        <property name="attributeService" ref="attributeService"/>
    </bean>	
    
    <bean id="staticDeviceGroupProvider"
        class="com.cannontech.common.device.groups.dao.impl.providers.StaticDeviceGroupProvider">
        <property name="deviceGroupEditorDao" ref="deviceGroupEditorDao"/>
        <property name="deviceGroupMemberEditorDao" ref="deviceGroupMemberEditorDao"/>
        <property name="mainDelegator" ref="deviceGroupDao"/>
    </bean>
    
    <bean id="rolodexDeviceGroupProvider"
        class="com.cannontech.common.device.groups.dao.impl.providers.RolodexGroupProvider">
        <property name="mainDelegator" ref="deviceGroupDao"/>
    </bean>
    
    <bean id="routeGroupProvider"
        class="com.cannontech.common.device.groups.dao.impl.providers.RouteGroupProvider">
        <property name="mainDelegator" ref="deviceGroupDao"/>
    </bean>
    
    <bean id="deviceTypeGroupProvider"
        class="com.cannontech.common.device.groups.dao.impl.providers.DeviceTypeGroupProvider">
        <property name="mainDelegator" ref="deviceGroupDao"/>
    </bean>
    
    <bean id="loadProfileScanIndicatingDevice" class="com.cannontech.common.device.groups.dao.impl.providers.helpers.LoadProfileScanIndicatingDevice" />
    <bean id="loadProfileScanningMetersGroupProvider" class="com.cannontech.common.device.groups.dao.impl.providers.ScanningMetersGroupProvider">
        <property name="mainDelegator" ref="deviceGroupDao"/>
        <property name="scanIndicatingDevice" ref="loadProfileScanIndicatingDevice"/>
    </bean>
    
    <bean id="voltageProfileScanIndicatingDevice" class="com.cannontech.common.device.groups.dao.impl.providers.helpers.VoltageProfileScanIndicatingDevice" />
    <bean id="voltageProfileScanningMetersGroupProvider" class="com.cannontech.common.device.groups.dao.impl.providers.ScanningMetersGroupProvider">
        <property name="mainDelegator" ref="deviceGroupDao"/>
        <property name="scanIndicatingDevice" ref="voltageProfileScanIndicatingDevice"/>
    </bean>
    
    <bean id="integrityScanIndicatingDevice" class="com.cannontech.common.device.groups.dao.impl.providers.helpers.IntegrityScanIndicatingDevice" />
    <bean id="integrityScanningMetersGroupProvider" class="com.cannontech.common.device.groups.dao.impl.providers.ScanningMetersGroupProvider">
        <property name="mainDelegator" ref="deviceGroupDao"/>
        <property name="scanIndicatingDevice" ref="integrityScanIndicatingDevice"/>
    </bean>
    
    <bean id="accumulatorScanIndicatingDevice" class="com.cannontech.common.device.groups.dao.impl.providers.helpers.AccumulatorScanIndicatingDevice" />
    <bean id="accumulatorScanningMetersGroupProvider" class="com.cannontech.common.device.groups.dao.impl.providers.ScanningMetersGroupProvider">
        <property name="mainDelegator" ref="deviceGroupDao"/>
        <property name="scanIndicatingDevice" ref="accumulatorScanIndicatingDevice"/>
    </bean>
    
    <bean id="deviceGroupEditorDao"
        class="com.cannontech.common.device.groups.editor.dao.impl.DeviceGroupEditorDaoImpl">
        <property name="jdbcTemplate" ref="simpleJdbcTemplate"/>
        <property name="paoGroupsWrapper" ref="paoGroupsWrapper"/>
        <property name="nextValueHelper" ref="nextValueHelper"/>
    </bean>
    
    <bean id="disabledGroupProvider"
        class="com.cannontech.common.device.groups.dao.impl.providers.DisabledGroupProvider">
        <property name="mainDelegator" ref="deviceGroupDao"/>
        <property name="paoDao" ref="paoDao"/>
    </bean>
    
    <alias alias="deviceGroupMemberEditorDao" name="deviceGroupEditorDao"/>
    
    <bean id="deviceGroupDao"
        class="com.cannontech.common.device.groups.dao.impl.DeviceGroupProviderDaoMain">
        <property name="providers">
            <map>
                <entry key="STATIC" value-ref="staticDeviceGroupProvider"/>
                <entry key="ROLODEX" value-ref="rolodexDeviceGroupProvider"/>
                <entry key="ROUTE" value-ref="routeGroupProvider"/>
                <entry key="DEVICETYPE" value-ref="deviceTypeGroupProvider"/>
                <entry key="METERS_SCANNING_LOAD_PROFILE" value-ref="loadProfileScanningMetersGroupProvider"/>
                <entry key="METERS_SCANNING_VOLTAGE_PROFILE" value-ref="voltageProfileScanningMetersGroupProvider"/>
                <entry key="METERS_SCANNING_INTEGRITY" value-ref="integrityScanningMetersGroupProvider"/>
                <entry key="METERS_SCANNING_ACCUMULATOR" value-ref="accumulatorScanningMetersGroupProvider"/>
                <entry key="METERS_DISABLED" value-ref="disabledGroupProvider"/>
            </map>
        </property>
        <property name="staticProvider" ref="staticDeviceGroupProvider"/>
    </bean>
    
    <bean id="deviceGroupService"
        class="com.cannontech.common.device.groups.service.impl.DeviceGroupServiceImpl">
        <property name="deviceGroupDao" ref="deviceGroupDao"/>
    </bean>
    
    <bean id="copyDeviceGroupService" class="com.cannontech.common.device.groups.service.impl.CopyDeviceGroupServiceImpl">
        <property name="deviceGroupDao" ref="deviceGroupDao" />
        <property name="deviceGroupEditorDao" ref="deviceGroupEditorDao" />
        <property name="deviceGroupMemberEditorDao" ref="deviceGroupMemberEditorDao" />
    </bean>
    
    <bean id="temporaryDeviceGroupService" class="com.cannontech.common.device.groups.service.impl.TemporaryDeviceGroupServiceImpl">
        <property name="deviceGroupEditorDao" ref="deviceGroupEditorDao" />
        <property name="scheduledExecutor" ref="globalScheduledExecutor" />
    </bean>
    
    <bean id="fixedDeviceGroupingHack"
        class="com.cannontech.common.device.groups.service.FixedDeviceGroupingHack">
        <property name="deviceGroupDao" ref="deviceGroupDao"/>
        <property name="deviceGroupEditorDao" ref="deviceGroupEditorDao"/>
        <property name="deviceGroupMemberEditorDao" ref="deviceGroupMemberEditorDao"/>
        <property name="deviceGroupService" ref="deviceGroupService"/>
        <property name="jdbcTemplate" ref="simpleJdbcTemplate"/>
    </bean>
    
    <bean id="peakReportDao"
        class="com.cannontech.common.device.peakReport.dao.impl.PeakReportDaoImpl">
        <property name="jdbcTemplate" ref="simpleJdbcTemplate"/>
        <property name="nextValueHelper" ref="nextValueHelper"></property>
    </bean>
    
    <bean id="deviceGroupTreeFactory"
        class="com.cannontech.common.device.groups.service.DeviceGroupTreeFactory">
        <property name="deviceGroupDao" ref="deviceGroupDao"/>
		<property name="deviceGroupService" ref="deviceGroupService"/>
    </bean>
    
    <bean id="deviceCreationService"
        class="com.cannontech.common.device.creation.impl.DeviceCreationServiceImpl">
        <property name="deviceDao" ref="deviceDao"/>
        <property name="paoDao" ref="paoDao"/>
        <property name="pointDao" ref="pointDao"/>
        <property name="paoGroupsWrapper" ref="paoGroupsWrapper"/>
        <property name="dbPersistantDao" ref="dbPersistentDao" />
        <property name="deviceGroupEditorDao" ref="deviceGroupEditorDao" />
        <property name="deviceGroupMemberEditorDao" ref="deviceGroupMemberEditorDao" />
        <property name="simpleDeviceDefinitionService" ref="simpleDeviceService" />
    </bean>
    
    <bean id="groupCommandExecutor" class="com.cannontech.common.device.commands.impl.GroupCommandExecutorImpl" lazy-init="true">
    </bean>
    
    <bean id="routeLocateResultsCache" class="com.cannontech.common.util.RecentResultsCache"/>
    
    <bean id="routeLocateExecutor" class="com.cannontech.common.device.routeLocate.impl.RouteLocateExecutorImpl">
        <property name="routeDiscoveryService" ref="routeDiscoveryService" />
        <property name="temporaryDeviceGroupService" ref="temporaryDeviceGroupService" />
        <property name="paoDao" ref="paoDao" />
        <property name="deviceUpdateService" ref="deviceUpdateService" />
        <property name="routeLocateResultsCache" ref="routeLocateResultsCache" />
        <property name="deviceGroupMemberEditorDao" ref="deviceGroupMemberEditorDao" />
        <property name="deviceGroupCollectionHelper" ref="deviceGroupCollectionHelper" />
    </bean>
    
</beans>