<?xml version="1.0" encoding="UTF-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema">

    <xs:element name="paoDefinitions">
        <xs:complexType>
            <xs:sequence>
              <xs:element name="pao" type="paoType" maxOccurs="unbounded">
              </xs:element>
            </xs:sequence>
        </xs:complexType>
        <xs:unique name="displayNameUniq">
            <xs:selector xpath="pao"/>
            <xs:field xpath="displayName"/>
        </xs:unique>
    </xs:element>

	<!-- PAO -->
	<xs:attributeGroup name="paoAttributes">
		<xs:attribute name="id" type="xs:ID" use="required" /> <!-- Unique identifier for parser. Must be PaoTypes Java constant for non-abstract paos. -->
		<xs:attribute name="enabled" type="xs:boolean" default="true" />
		<xs:attribute name="abstract" type="xs:boolean" default="false" />
	    <xs:attribute name="inherits" type="xs:string" />
	    <xs:attribute name="creatable" type="xs:boolean" default="true" />
    </xs:attributeGroup>
    
    <xs:complexType name="paoType">
      <xs:sequence minOccurs="1" maxOccurs="1">
        <xs:element name="displayName" type="xs:string" minOccurs="0" />
        <xs:element name="displayGroup" type="xs:string" minOccurs="0" />
        <xs:element name="changeGroup" type="xs:string" minOccurs="0" />
        <xs:element name="points" type="pointsType" minOccurs="0">
            <xs:unique name="pointTypeAndIdUniq">
                <xs:selector xpath="point"/>
                <xs:field xpath="@type"/>
                <xs:field xpath="@offset"/>
            </xs:unique>
            <xs:unique name="pointNameKey">
                <xs:selector xpath="point"/>
                <xs:field xpath="name"/>
            </xs:unique>
        </xs:element>
        <xs:element name="commands" type="commandsType" minOccurs="0">
            <xs:unique name="commandIdUniq">
                <xs:selector xpath="command"/>
                <xs:field xpath="@id"/>
            </xs:unique>
        </xs:element>
        <xs:element name="attributes" type="attributesType" minOccurs="0" >
            <xs:unique name="attributeNameUniq">
                <xs:selector xpath="attribute"/>
                <xs:field xpath="@name"/>
            </xs:unique>
        </xs:element>
        <xs:element name="tags" type="tagType" minOccurs="0" />
      </xs:sequence>
      <xs:attributeGroup ref="paoAttributes" />
    </xs:complexType>
    
    <!-- TAGS -->
    <xs:attributeGroup name="tagAttributes">
		<xs:attribute name="name" type="xs:string" use="required" />
		<xs:attribute name="supports" type="xs:boolean" default="true"/>
    </xs:attributeGroup>
    
    <xs:complexType name="tagType">
	    <xs:sequence>
	        <xs:element name="tag" minOccurs="0" maxOccurs="unbounded">
	            <xs:complexType>
	                <xs:sequence>
	                    <xs:element name="value" type="xs:string" minOccurs="0" />
	                </xs:sequence>
	                <xs:attributeGroup ref="tagAttributes" />
	            </xs:complexType>
	        </xs:element>
	    </xs:sequence>
    </xs:complexType>

    <xs:simpleType name="updateTypeType">
        <xs:restriction base="xs:string">
            <xs:enumeration value="On First Change"/>
            <xs:enumeration value="On All Change"/>
            <xs:enumeration value="On Timer"/>
            <xs:enumeration value="On Timer+Change"/>
            <xs:enumeration value="Constant"/>
            <xs:enumeration value="Historical"/>
        </xs:restriction>
    </xs:simpleType>

	<!-- We do not yet support the Constant or Function componentTypes -->
    <xs:simpleType name="componentTypeType">
        <xs:restriction base="xs:string">
            <xs:enumeration value="Operation"/>
        </xs:restriction>
    </xs:simpleType>

    <xs:simpleType name="controlTypeType">
        <xs:restriction base="xs:string">
            <xs:enumeration value="NONE"/>
            <xs:enumeration value="NORMAL"/>
            <xs:enumeration value="LATCH"/>
            <xs:enumeration value="PSEUDO"/>
            <xs:enumeration value="SBOLATCH"/>
            <xs:enumeration value="SBOPULSE"/>
        </xs:restriction>
    </xs:simpleType>

    <xs:simpleType name="stateControlType">
        <xs:restriction base="xs:string">
            <xs:enumeration value="OPEN"/>
            <xs:enumeration value="CLOSE"/>
        </xs:restriction>
    </xs:simpleType>

	<!-- POINTS -->
	<xs:attributeGroup name="pointAttributes">
		<xs:attribute name="type" type="xs:string" use="required" /> <!-- Type and offset together is the unique identifier for points for the parser. -->
        <xs:attribute name="offset" type="xs:nonNegativeInteger" use="required" />
        <xs:attribute name="enabled" type="xs:boolean" default="true" />
    </xs:attributeGroup>
    
    <xs:complexType name="archiveDefaults">
	    <xs:sequence>
	        <xs:element name="type" type="xs:string" minOccurs="0" default="NONE" />
			<xs:element name="interval" type="xs:string" minOccurs="0" default="ZERO" />
	    </xs:sequence>
    </xs:complexType>
    
    <xs:complexType name="pointsType">
	    <xs:sequence>
	        <xs:element name="point" minOccurs="0" maxOccurs="unbounded">
	            <xs:complexType>
	                <xs:sequence>
	                    <xs:element name="init" type="xs:boolean" minOccurs="0" default="false" />
	                    <xs:element name="name" type="xs:string" minOccurs="0" />
	                    <xs:element name="description" type="xs:string" minOccurs="0" />
						<xs:element name="controlType" type="controlTypeType" minOccurs="0" default="NONE" />
						<xs:element name="controlOffset" type="xs:integer" minOccurs="0" default="1" />
						<xs:element name="stateZeroControl" type="stateControlType" minOccurs="0" default="OPEN" />
						<xs:element name="stateOneControl" type="stateControlType" minOccurs="0" default="CLOSE" />
						<xs:element name="archive" type="archiveDefaults" minOccurs="0" />
	                    <xs:choice>
	                        <xs:sequence>
	                            <xs:element name="multiplier">
	                                <xs:complexType>
	                                    <xs:attribute name="value" type="xs:decimal" use="required" />
	                                </xs:complexType>
	                            </xs:element>
	                            <xs:element name="unitofmeasure">
	                                <xs:complexType>
	                                    <xs:attribute name="value" type="xs:string" use="required" />
	                                </xs:complexType>
	                            </xs:element>
	                            <xs:element name="decimalplaces">
	                                <xs:complexType>
	                                    <xs:attribute name="value" type="xs:integer" use="required" />
	                                </xs:complexType>
	                            </xs:element>
                                <xs:element name="analogstategroup" minOccurs="0">
                                    <xs:complexType>
                                        <xs:attribute name="value" type="xs:string" use="required" />
                                        <xs:attribute name="initialState" type="xs:string" />
                                    </xs:complexType>
                                </xs:element>
	                        </xs:sequence>
	                        <xs:element name="stategroup">
	                            <xs:complexType>
	                                <xs:attribute name="value" type="xs:string" use="required" />
                                    <xs:attribute name="initialState" type="xs:string" />
	                            </xs:complexType>
	                        </xs:element>
	                    </xs:choice>
                        <xs:element name="calculation" minOccurs="0">
                            <xs:complexType>
                                <xs:sequence>
                                    <xs:element name="forceQualityNormal" minOccurs="0" type="xs:boolean" default="false" />
                                    <xs:element name="periodicRate" minOccurs="0" type="xs:integer" default="1" />
                                    <xs:element name="updateType" minOccurs="0" type="updateTypeType" default="On First Change" />
									<xs:element name="components" minOccurs="1" maxOccurs="1">
			                            <xs:complexType>
			                                <xs:sequence>
			                                    <xs:element name="component" minOccurs="1" maxOccurs="unbounded">
			                                        <xs:complexType>
														<xs:attribute name="point" type="xs:string" use="required" />
														<xs:attribute name="componentType" type="componentTypeType" default="Operation" />
														<xs:attribute name="operator" type="xs:string" default="+" />
			                                        </xs:complexType>
			                                    </xs:element>
	                                    	</xs:sequence>
	                                    </xs:complexType>
                                    </xs:element>
                                </xs:sequence>
                            </xs:complexType>
                        </xs:element>
	                </xs:sequence>
	                <xs:attributeGroup ref="pointAttributes" />
	            </xs:complexType>
	        </xs:element>
	    </xs:sequence>
    </xs:complexType>
    
    <!-- ATTRIBUTES -->
    <xs:attributeGroup name="attributeAttributes">
        <xs:attribute name="name" type="xs:string" use="required"/> <!-- Attribute name is the unique identifier for the parser. -->
        <xs:attribute name="enabled" type="xs:boolean" default="true" />
    </xs:attributeGroup>
    
    <xs:complexType name="attributesType">
        <xs:sequence>
            <xs:element name="attribute" minOccurs="0" maxOccurs="unbounded">
                <xs:complexType>
                	<xs:sequence>
                		<xs:choice >
                			<xs:element name="basicLookup" maxOccurs="1">
                				<xs:complexType>
                					<xs:attribute name="point" type="xs:string" use="required" />
                				</xs:complexType>
                			</xs:element>
                			<xs:element name="mappedLookup" maxOccurs="1">
                                <xs:complexType>
                                    <xs:choice>
		                                <xs:element name="typeFilter" maxOccurs="1">
			                                <xs:complexType>
			                                    <xs:attribute name="type" type="xs:string" use="required" />
			                                </xs:complexType>
		                                </xs:element>
	                                </xs:choice>
                                </xs:complexType>
                            </xs:element>
                		</xs:choice>
                	</xs:sequence>
                	<xs:attributeGroup ref="attributeAttributes" />
                </xs:complexType>
            </xs:element>
        </xs:sequence>
    </xs:complexType>
    
    <!-- COMMANDS -->
    <xs:attributeGroup name="commandAttributes">
        <xs:attribute name="id" type="xs:string" use="required"/>
        <xs:attribute name="enabled" type="xs:boolean" default="true" />
    </xs:attributeGroup>
    
    <xs:complexType name="commandsType">
	    <xs:sequence>
	        <xs:element name="command" minOccurs="0" maxOccurs="unbounded">
	            <xs:complexType>
	                <xs:sequence>
	                	<xs:element name="name" type="xs:string"/>
	                    <xs:element name="cmd" minOccurs="1" maxOccurs="unbounded">
	                        <xs:complexType>
	                   <xs:attribute name="text" type="xs:string" use="required" />
	                        </xs:complexType>
	                    </xs:element>
	                    <xs:element name="pointRef" minOccurs="0" maxOccurs="unbounded">
	                        <xs:complexType>
	                   <xs:attribute name="name" type="xs:string" use="required" />
	                        </xs:complexType>
	                    </xs:element>
	                </xs:sequence>
	                <xs:attributeGroup ref="commandAttributes" />
	            </xs:complexType>
	        </xs:element>
	    </xs:sequence>
    </xs:complexType>

</xs:schema>
