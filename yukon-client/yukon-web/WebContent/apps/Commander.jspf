<%@ page import="com.cannontech.core.dao.DaoFactory"%>
<%@ page import="com.cannontech.database.data.lite.LiteDeviceTypeCommand"%> 
<%@ page import="com.cannontech.database.data.lite.LiteCommand"%> 
<%@ page import="com.cannontech.database.db.command.CommandCategory"%>
<%@ page import="com.cannontech.database.data.lite.LiteYukonPAObject" %>

<style type="text/css">
div.scroll { font-size: 12px; 
			 height: 350px;  
			 width: 600px; 
			 overflow: scroll; 
			 border: 1px solid #CCCCCC; 
			 text-align:left; 
			 padding: 8px;}
</style>

<%
	//set the deviceID of the YC_BEAN
	YC_BEAN.setDeviceID(deviceID);
	
	if( serialType.equals("xcom"))
	{
	    YC_BEAN.setDeviceType(CommandCategory.STRING_CMD_EXPRESSCOM_SERIAL);
	    YC_BEAN.setSerialNumber(YC_BEAN.getDeviceType(), serialNum);
	} else if( serialType.equals("vcom")) {
	    YC_BEAN.setDeviceType(CommandCategory.STRING_CMD_VERSACOM_SERIAL);
	    YC_BEAN.setSerialNumber(YC_BEAN.getDeviceType(), serialNum);
	} else if( serialType.equals("sa205") ) {
	    YC_BEAN.setDeviceType(CommandCategory.STRING_CMD_SA205_SERIAL);
	    YC_BEAN.setSerialNumber(YC_BEAN.getDeviceType(), serialNum);
	} else if( serialType.equals("sa305")) {
	    YC_BEAN.setDeviceType(CommandCategory.STRING_CMD_SA305_SERIAL);
	    YC_BEAN.setSerialNumber(YC_BEAN.getDeviceType(), serialNum);
	} else {
	    YC_BEAN.setDeviceType(deviceID);    //default to the type of the deviceID selected
	}
%>     
     
<SCRIPT language="JavaScript">
    function disableButton(x) {
        x.disabled = true;
        document.commandForm.submit();
    }
    function loadCommand() {
        document.commandForm.command.value = document.commandForm.commonCommand.value;
    }
</SCRIPT>
    
<% 
	String name = null;
    if( serialType.equals("xcom")) {
    	name = "Expresscom";
 	} else if( serialType.equals("vcom")) {
    	name = "Versacom";
	} else if( serialType.equals("sa205")) {
		name = "DCU-205";
	} else if( serialType.equals("sa305")) {
		name = "DCU-305";
	} else {
		name = liteYukonPao.getPaoName();
    }
%>


<%@ include file="MspCISDetail.jspf"%>

	<div class="titleHeader"> 
		CONTROL COMMANDS
	</div>
	
	<div class="subTitleHeader">
		<%=name%>
	</div>
	
	<form name="commandForm" method="POST" action="<%= request.getContextPath() %>/servlet/CommanderServlet">
		<input type="hidden" name="deviceID" value="<%=deviceID%>">
	    <input type="hidden" name="timeOut" value="8000">
	    <%--The jsp wrapping this page needs to tell us "redirect"s value --%>
	    <input id="redirect" type="hidden" name="REDIRECT" value="<%= redirect %>">
	    <input id="referrer" type="hidden" name="REFERRER" value="<%= redirect %>">
					
		<table align="center">
	    	<tr> 
	          	<td class="SubtitleHeader" align="right">Type:</td>
	              <td class="tableCell" colspan="2"><%=YC_BEAN.getDeviceType()%></td>
	        </tr>
		
<% 
	if( serialType.length() > 0) {
%>
			<tr> 
               	<td class="SubtitleHeader" align="right">Serial Number:</td>
               	<td class="tableCell" colspan="2">
                	<input type="text" name="serialNumber" size="20" value="<%=serialNum%>">
               	</td>
			</tr>
            <tr> 
                <td class="SubtitleHeader" height="2" align="right">Route:</td>
                <td class="tableCell" colspan="2" height="2"> 
                	<select id="routeID" name="routeID">
                   		<option VALUE="-1">Select a Route
<%
		LiteYukonPAObject[] validRoutes = YC_BEAN.getValidRoutes();
		for (int i = 0; i < validRoutes.length; i++) {
%>
						<option VALUE="<%=((LiteYukonPAObject)validRoutes[i]).getYukonID()%>" <%=YC_BEAN.getRouteID()==((LiteYukonPAObject)validRoutes[i]).getYukonID() ? "selected" : ""%>><%=((LiteYukonPAObject)validRoutes[i]).getPaoName()%>
<%
		}
%>
					</select>
               	</td>
			</tr>
<%
	}
%>
			<tr> 
	        	<td class="SubtitleHeader" align="right">Common Commands:</td>
	            <td class="tableCell" colspan="2">
	            	<select name="commonCommand" onChange="loadCommand()" onInit="loadCommand()">
	                	<option value="">Select a Command</option>                
<%
	Object commandObject = liteYukonPao;
	if(serialType.length() > 0){
		commandObject = serialType;
	}


	String tempCommand = YC_BEAN.getCommandString().replaceAll("noqueue", "").trim();
    for (int i = 0; i < YC_BEAN.getLiteDeviceTypeCommandsVector().size(); i++) {
		LiteDeviceTypeCommand ldtc = (LiteDeviceTypeCommand)YC_BEAN.getLiteDeviceTypeCommandsVector().get(i);
		LiteCommand lc = DaoFactory.getCommandDao().getCommand(ldtc.getCommandID());
		String commandString = lc.getCommand();
        if( ldtc.isVisible() && YC_BEAN.isAllowCommand(commandString, lYukonUser, commandObject)) {
%>
						<option value='<%=commandString%>' <%=(commandString.equalsIgnoreCase(tempCommand))? "selected":""%> ><%=lc.getLabel()%></option>
<%
		}
	}
%>
					</select>
				</td>
			</tr>
	        <tr> 
	        	<td class="SubtitleHeader" align="right">Execute Command:</td>
	            <td class="tableCell">
	            	<input type="text" name="command" <cti:isPropertyFalse property="CommanderRole.EXECUTE_MANUAL_COMMAND">readonly</cti:isPropertyFalse> size="40" value="<%=YC_BEAN.getCommandString()%>">
	            </td>
	            <td>
	            	<input type="submit" name="execute" value="Execute" onClick="disableButton(this)">
	            </td>
			</tr>
			<tr>
				<td colspan="3">
	    		<div class="scroll">
    	    		<c:out value="${YC_BEAN.resultText}" escapeXml="false"/>
	        	</div>
	    		<input type="submit" name="clearText" value="Clear Results">
        		<input type="reset" name="refresh" value="Refresh" onClick="window.location.reload()">
				</td>
			</tr>
		</table>
	</form>
<% 
	String gotoLink = "";
	if (request.getParameter("InvNo") != null){ //we came from the Customer Account page
		gotoLink =  request.getContextPath()+"/operator/Consumer/CommandInv.jsp?InvNo="+invNo+"&command=null";
	} else {
		gotoLink = request.getContextPath()+"/apps/CommandDevice.jsp?deviceID="+deviceID+"&command=null";
	}
    if (isMCT4XX) {
%>
	<div class="bottomLink">
		<a href="<%= gotoLink%>" name="advCommander4XX"  class="Link1">Commander: MCT400series Custom</a>
	</div>
<%
	}
	if (request.getParameter("InvNo") != null) {  //we came from the Customer Account page
    		gotoLink = request.getContextPath()+"/operator/Consumer/CommandInv.jsp?InvNo="+invNo+"&lp";
	} else {
		gotoLink = request.getContextPath()+"/apps/CommandDevice.jsp?deviceID="+deviceID+"&lp";
	}
	if (isMCT4XX ) {
%>
	<div class="bottomLink">
		<a href="<%= gotoLink%>" name="advCommander4XX"  class="Link1">Commander: MCT400series Profile</a>
	</div>
<%
	}
%>

