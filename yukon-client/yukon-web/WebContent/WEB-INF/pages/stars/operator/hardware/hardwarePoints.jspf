<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="cti" uri="http://cannontech.com/tags/cti"%>
<%@ taglib prefix="tags" tagdir="/WEB-INF/tags" %>
<%@ taglib prefix="i" tagdir="/WEB-INF/tags/i18n" %>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>

<script type="text/javascript">
$(function() {
    <c:if test="${hardware.hardwareType.rf}">
        setupClickHandler('#rfReadNow', '<cti:url value="/stars/operator/hardware/rf/readNow"/>');
    </c:if>
    <c:if test="${hardware.hardwareType.twoWayPlcLcr}">
        setupClickHandler('#plcReadNow', '<cti:url value="/stars/operator/hardware/plc/readNow"/>');
    </c:if>
    <c:if test="${hardware.hardwareType.ecobee}">
        setupClickHandler('#ecobeeReadNow', '<cti:url value="/stars/operator/hardware/ecobee/readNow"/>');
    </c:if>
    
    function setupClickHandler(selector, url) {
        $(document).on('click', selector, function(event) {
            $.ajax({
                url: url,
                method: 'get',
                data: {'deviceId': '${hardware.deviceId}'}
            }).done(function(data) {
                $('#commandStatus').html(data.message);
                $('#commandStatus').show();
                if (data.success ==  true) {
                    $('#commandStatus').addClass('success').removeClass('error');
                } else {
                    $('#commandStatus').removeClass('success').addClass('error');
                }
            }).always(function() {
                yukon.ui.unbusy($(selector));
            });
        });
    }
});
</script>

<tags:sectionContainer2 nameKey="hardwarePoints">
    <c:forEach var="entry" items="${points}">
        <c:if test="${fn:length(entry.value) > 0}">
            <span><i:inline key="${entry.key}" /></span>
            <div class="scroll-small lite-container stacked dashed">
                <table class="compact-results-table">
                    <c:forEach var="point" items="${entry.value}">
                        <tr>
                            <td>${fn:escapeXml(point.pointName)}</td>
                            <td class="last"><cti:pointValue pointId="${point.liteID}" colorForStatus="true"/></td>
                        </tr>
                    </c:forEach>
                </table>
            </div>
        </c:if>
    </c:forEach>
        <c:if test="${hardware.hardwareType.rf or hardware.hardwareType.twoWayPlcLcr 
                        or hardware.hardwareType.ecobee}">
            <div id="commandStatus" class="dn error"></div>
        </c:if>
    <div class="action-area">
        <cti:url var="pointsUrl" value="/stars/operator/hardware/points">
            <cti:param name="deviceId" value="${hardware.deviceId}"/>
            <cti:param name="accountId" value="${accountId}"/>
        </cti:url>
        <a href="${pointsUrl}"><i:inline key="yukon.web.defaults.showAll"/></a>
        <c:if test="${hardware.hardwareType.rf}">
            <cti:button id="rfReadNow" nameKey="readNow" busy="true" icon="icon-read"/>
        </c:if>
        <c:if test="${hardware.hardwareType.ecobee}">
            <cti:button id="ecobeeReadNow" nameKey="readNow" busy="true" icon="icon-read"/>
        </c:if>
        <c:if test="${hardware.hardwareType.twoWayPlcLcr}">
            <cti:button id="plcReadNow" nameKey="readNow" busy="true" icon="icon-read"/>
        </c:if>
    </div>
</tags:sectionContainer2>