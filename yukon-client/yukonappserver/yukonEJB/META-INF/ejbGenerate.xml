<?xml version="1.0"?>

<project name="Test" default="main" basedir=".">

   <!-- Init -->
   <target name="init">

      <property name="xdoclet.jar.path" value="${eclipse.home}/plugins/com.objectlearn.jdt.j2ee/xdoclet.jar" />
      <property name="log4j.jar.path" value="${eclipse.home}/plugins/com.objectlearn.jdt.j2ee/log4j.jar" />

      <property name="bin.dir" value="../bin" />
      <property name="ejb.dd.dir" value="META-INF"/>
      <property name="web.dd.dir" value="WEB-INF"/>
      <property name="xdoclet.force" value="true"/>


      <property name="container.type" value="ejb-jar"/>
      
   	  <!-- Set up java.class.path -->
      <path id="project.class.path">
        <pathelement location="${xdoclet.jar.path}" />
        <pathelement location="${log4j.jar.path}" />

        <pathelement location="${bin.dir}" />
        

        <!-- append the path sent through eclipse to classpath -->
        <pathelement path="${pcpath}" />

      	<fileset dir="${eclipse.home}/plugins">
        	<include name="**/ant.jar"/>
      	</fileset>

        <!-- append the external classpath lastly -->
        <pathelement path="${java.class.path}" />       

      </path>


   </target>

   <!-- Run EJBDoclet -->
   <target name="ejbdoclet" depends="init">

      <taskdef name="ejbdoclet" classname="xdoclet.ejb.EjbDocletTask">
		<classpath refid="project.class.path"/>
	</taskdef>

	<echo message="classpath : ${pcpath}" />

      <ejbdoclet
         sourcepath="${src.dir}"
         destdir="${ejbsrc.dir}"
         classpathref= "project.class.path"
         excludedtags="@version,@author"
         ejbspec="2.0"
         force="${xdoclet.force}">

         <fileset dir=".." includesfile="META-INF/ejbs.xml" />

         <dataobject/>
         <remoteinterface/>
         <localinterface/>
         <homeinterface />
         <utilobject/>
         <localhomeinterface/>
         <entitypk/>
         <entitycmp/>
         <entitybmp/>
         <session/>

         <deploymentdescriptor destdir="${ejb.dd.dir}" validatexml="true" />

         <!--
         Have struts form objects generated based on entity beans'
         data objects.  Will require struts.jar to compile. -->
         <strutsform />


         <!--
         Have a mapping.xml file generated for castor classes.
         -->
         <castormapping destdir="${ejb.dd.dir}" validatexml="false" />
         <!-- -->

	      <weblogic
	         version="6.1"
	         xmlencoding="UTF-8"
	         destdir="${ejb.dd.dir}"
	         validatexml="false"
	         datasource="PLEASE_MODIFY_THIS"
	         mergedir="${ejb.dd.dir}"
	      />
		  <jboss
            version="3.0"
            xmlencoding="UTF-8"
            destdir="${ejb.dd.dir}"
            validatexml="false"
            typemapping="PLEASE_MODIFY_THIS"
          />
         
      </ejbdoclet>
   </target>

   <!-- Create EJB-JAR file -->
   <target name="ejb-jar" depends="init">
   	  <delete file="${container}.jar" />
      <jar jarfile="${container}.jar">         
        <fileset dir="${bin.dir}">   
           <include name="**/*.class"/>
        </fileset>
        <fileset dir=".">   
           <include name="META-INF/**/*.*"/>
           <exclude name="META-INF/beans.xml"/>
           <exclude name="META-INF/build.xml"/>
           <exclude name="META-INF/ejbs.xml"/>
           <exclude name="META-INF/ejbGenerate.xml"/>
           <exclude name="META-INF/servers.xml"/>
        </fileset>
      </jar>
   </target>

   <target name="weblogic-ejb-jar" depends="ejb-jar">
      <java classname="weblogic.ejbc20" fork="true">
         <arg value="${container}.jar"/>
         <arg value="${container}Compiled.jar"/>
      </java>
   </target>

   <!-- Deploy to ... -->
   <target name="deploy" depends="ejb-jar">
      <copy todir="${deploy.dir}">
         <fileset dir="." includes="${container}.jar"/>
      </copy>
   </target>

</project>
