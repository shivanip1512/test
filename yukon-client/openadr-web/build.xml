<?xml version="1.0" ?>
<project name="openadr" default="all">

    <property environment="env"/>   
    <property file="../build/build.properties" />
    <property name="yukon.web.build" value="build"/>
    
    <target name="all" depends="clean, build" />

    <target name="build" depends="compile, war"/>

    <!-- 
        Target to delete all of the files and directories from any previous builds
     -->
    <target name="clean">
        <delete file="${yukon.lib}/openadr.war" />
        <delete dir="build" />
    </target>
    
    <fileset dir="${yukon.lib}" id="yukon.lib.files">
        <include name="activation.jar"/>
        <include name="activemq-core-5.7.0.jar"/>
        <include name="aopalliance.jar"/>
        <include name="asm-attrs.jar"/>
        <include name="asm.jar"/>
        <include name="aspectjrt.jar"/>
        <include name="aspectjweaver.jar"/>
        <include name="axiom.jar"/>
    	<include name="bcpkix-jdk15on-149.jar"/>
    	<include name="bcprov-jdk15on-149.jar"/>
        <include name="cglib-2.1.3.jar"/>
        <include name="ojdbc6.jar"/>
        <include name="common.jar"/>
        <include name="commons-codec-1.9.jar"/>
        <include name="commons-collections-3.2.jar"/>
        <include name="commons-dbcp-1.4.jar"/>
        <include name="commons-fileupload-1.3.1.jar"/>
        <include name="commons-httpclient.jar"/>
        <include name="commons-io-2.4.jar"/>
        <include name="commons-lang-2.3.jar"/>
        <include name="commons-logging-1.1.3.jar"/>
        <include name="commons-pool-1.4.jar"/>
        <include name="dom4j-1.6.1.jar"/>
        <include name="ecs-1.4.2.jar"/>
        <include name="nagasena.jar"/>
        <include name="geronimo-j2ee-management_1.1_spec-1.0.1.jar"/>
        <include name="geronimo-jms_1.1_spec-1.1.1.jar"/>
        <include name="guava-13.0.1.jar"/>
        <include name="i18n-en_US.jar"/>
        <include name="jasypt-1.9.0.jar"/>
        <include name="jaxen-1.1.1.jar"/>
        <include name="jaxm-api.jar"/>
        <include name="jcfield401K.jar"/>
        <include name="jcommon.jar"/>
        <include name="jcpagelayout450K.jar"/>
        <include name="jdom.jar"/>
        <include name="jfreechart.jar"/>
        <include name="joda-time-2.1.jar"/>
        <include name="jopcbridge.jar"/>
        <include name="jradius-client.jar"/>
        <include name="jta.jar"/>
        <include name="jtds-1.3.0.jar"/>
        <include name="junit-4.8.2.jar"/>
        <include name="kahadb-5.7.0.jar"/>
        <include name="loadcontrol.jar"/>
        <include name="log4j-1.2.17.jar"/>
        <include name="lucene-core-3.4.0.jar"/>
        <include name="mail.jar"/>
        <include name="mx4j-tools.jar"/>
        <include name="mx4j.jar"/>
        <include name="notification.jar"/>
        <include name="org.osgi.core-4.1.0.jar"/>
        <include name="quartz-all-1.6.0.jar"/>
        <include name="saaj.jar"/>
        <include name="slf4j-api-1.6.6.jar"/>
        <include name="slf4j-log4j12-1.7.2.jar"/>
        <include name="spring-ws-1.5.6-all.jar"/>
        <include name="org.springframework.*-3.1.3.RELEASE.jar"/>
        <include name="SqlServer.jar"/>
        <include name="web-common.jar"/>
        <include name="wsdl4j.jar"/>
        <include name="xercesImpl.jar"/>
        <include name="xml-apis.jar"/>
        <include name="XmlSchema-1.4.2.jar"/>
        <include name="yc.jar"/>
        <include name="yukonappserver.jar"/>
    </fileset>

    <target name="compile">

        <mkdir dir="${yukon.web.build}" />

        <javac srcdir="src"
               destdir="${yukon.web.build}"
               target="${yukon.javac.target}"
               source="${yukon.javac.source}"
               bootclasspath="${yukon.javac.bootclasspath}"
               debug="${yukon.javac.debug}">
            <classpath>
                <fileset refid="yukon.lib.files"/>
            </classpath>
        </javac>

    </target>

    <!--
        Target to create a yukon.war file with precompiled jsps included
    -->   
    <target name="war" depends="compile">

        <war destfile="${yukon.lib}/openadr.war" duplicate="fail">
            <manifest>
                <attribute name="Yukon-Version" value="${yukon.build.version}"/>
                <attribute name="Yukon-Details" value="${yukon.build.details}"/>
            </manifest>
            <zipfileset refid="yukon.lib.files" prefix="WEB-INF/lib"/>
            <zipfileset dir="${yukon.web.build}" prefix="WEB-INF/classes"/>
            <zipfileset dir="src" prefix="WEB-INF/classes">
                <exclude name="**/*.java"/>
            </zipfileset>
            <fileset dir="WebContent"/>
        </war>  
        
    </target>   

    <!-- Run unit tests - will stop running if a failure or error occurs during a test -->
    <target name="runUnitTests" description="Run all unit tests, stop on failure" />

</project>