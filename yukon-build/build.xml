<?xml version="1.0" ?>
<project name="Yukon CruiseControl Ant Build Script" default="targets" basedir="..\">

    <property environment="env"/> 	 	 
	 	      	     	     
    <target name="targets">
        <echo message="The following targets are available"/>
        <echo message="                  For all the build targets:"/>
        <echo message="                  define build.label to embed a label or version into the software"/>
        <echo message=" tag            - tag the current sandbox, define yukon.tag"/> 
        <echo message="                  I.e. build.label=3_3_3 will create a tag like TG20061003_3_3_3_103043"/>
        <echo message=" branch         - branch the current sandbox, define yukon.tag"/>
        <echo message="                  I.e. build.label=3_3_3 will result in a branch tag like BR20061003_3_3_3_103043"/>    	
    	<echo message="[CVS Targets]"/>
    	<echo message="checkout-all				- cvs checkout the entire Yukon module"/>
    	<echo message="checkout-client			- cvs checkout yukon-client module"/>
    	<echo message="checkout-server			- cvs checkout yukon-server module"/>
    	<echo message="checkout-install			- cvs checkout yukon-install module"/>
    	<echo message="checkout-database 		- cvs checkout yukon-database module"/>
    	<echo message=""/>
    	<echo message="update-all				- cvs update the entire Yukon module"/>
    	<echo message="update-client			- cvs update yukon-client module"/>
    	<echo message="update-server			- cvs update yukon-server module"/>
    	<echo message="update-install			- cvs update yukon-install module"/>
    	<echo message="update-database			- cvs update yukon-database module"/>
    	<echo message=""/>
    	<echo message="[Build Targets]"/>
    	<echo message="build					- runs buildclient,buildserver,buildinstaller targets"/>
    	<echo message="build-client				- runs update-client target, compiles yukon-client module"/>
    	<echo message="build-server				- runs update-server target, compiles yukon-server module"/>
    	<echo message="build-install				- runs update-install target, compiles yukon-install module"/>
    </target>	
    	
    	<!--
        <echo message=" builddist      - "/>
        <echo message=" checkout       - checkout the entire Yukon project"/>
        <echo message="                  define yukon.tag to checkout a specific tag or branch"/>
        <echo message=" update         - cvs update the entire Yukon project"/>
        <echo message="                  define yukon.tag to update to a specific tag or branch"/>
        <echo message=" clean          - delete everything and start over clean"/>
        <echo message=" build          - compiles everything"/>
        <echo message=" buildclient    - compiles the Yukon clients and web applications"/>        
        <echo message=" buildserver    - compiles the Yukon background services"/>
        <echo message=" buildinstaller - packages everything up into a Installshield installer"/> 
        <echo message=" builddist      - packages and zips everything up for distribution "/>
        <echo message="                  For all the build targets:"/>
        <echo message="                  define build.label to embed a label or version into the software"/>
        <echo message=" tag            - tag the current sandbox, define yukon.tag"/> 
        <echo message="                  I.e. build.label=3_3_3 will create a tag like TG20061003_3_3_3_103043"/>
        <echo message=" branch         - branch the current sandbox, define yukon.tag"/>
        <echo message="                  I.e. build.label=3_3_3 will result in a branch tag like BR20061003_3_3_3_103043"/>
    </target> -->
            
    <target name="init">
        <tstamp/>
        <property name="tag.date" value="${DSTAMP}"/>
        <property name="tag.time" value="${TSTAMP}"/>
        <property name="yukon.build.version" value="${tag.date}_${yukon.tag}_${tag.time}"/>
		<!--	<property name="build.label" value="3_4_0_cc"/> this property is injected from cc -->
    </target>

    <target name="checktagdefined" depends="init">
        <condition property="isyukontagdefined">
            <isset property="yukon.tag" />
        </condition>    
    </target>	

    <target name="checkouthead" unless="isyukontagdefined">
        <echo message="checking out the main trunk (HEAD)"/>
        <cvs dest="." package="yukon" />
    </target>

    <target name="checkouttag" if="isyukontagdefined">
        <echo message="checking out by tag or branch: ${yukon.tag}"/>
        <cvs dest="." tag="${yukon.tag}" package="yukon" />
    </target>	
	
	<target name="checkout-all" depends="init,checkout-client,checkout-server,checkout-install,checkout-database"/>
	
	<target name="checkout-client" depends="init">
		<echo message="checking out module yukon-client"/>
		<cvs dest="." package="yukon-client"/>
	</target>
		
    <target name="checkout-server" depends="init">
		<echo message="checking out module yukon-server"/>
    	<cvs dest="." package="yukon-server"/>
	</target>
	
	<target name="checkout-install" depends="init">
		<echo message="checking out module yukon-install"/>
		<cvs dest="." package="yukon-install"/>
	</target>
	
	<target name="checkout-database" depends="init">
		<echo message="checking out module yukon-database"/>
		<cvs dest="." package="yukon-database"/>
    </target>
	
	<target name="update-all" depends="init,update-client,update-server,update-install,update-database"/>
	
	<target name="update-client" depends="init">
		<echo message="updating module yukon-client"/>
		<cvs dest="./yukon-client" command="update -A -d"/> 
    </target>
		
	<target name="update-server" depends="init">
		<echo message="updating module yukon-server"/>
		<cvs dest="./yukon-server" command="update -A -d"/> 
	</target>
	
	<target name="update-install" depends="init">
		<echo message="updating module yukon-install"/>
		<cvs dest="./yukon-install" command="update -A -d"/> 
	</target>	
	
	<target name="update-database" depends="init">
		<echo message="updating module yukon-database"/>
		<cvs dest="./yukon-database" command="update -A -d"/> 
	</target>	
	
	<target name="build" depends="build-client,build-server,build-install,update-database,cleandist,builddist"/>
	
	<target name="build-client" depends="update-client">
		<echo message="building module yukon-client"/>
		<exec failonerror="true" dir="./yukon-client/build" executable="cmd.exe">
			<arg line="/c antExit.bat -Dyukon.build.version=${build.label} build"/>
		</exec>
		<exec failonerror="true" dir="./yukon-client/build" executable="cmd.exe">
			<arg line="/c antExit.bat -Dyukon.build.version=${build.label} runUnitTests"/>
		</exec>
	</target>
	
	<target name="build-server" depends="update-server">
		<echo message="building module yukon-server"/>
		<exec failonerror="true" dir="./yukon-server/" executable="cmd.exe">
			<arg line="/c buildhereexit.cmd ${build.label}"/>
		</exec>	
	</target>
	
	<target name="build-install" depends="update-install">
		<copy todir="c:/software/install/lib/server">
	    	<fileset dir="./yukon-server/bin" includes="*.exe,*.dll"/>
	    </copy>

		<copy todir="c:/software/install/lib/client">
	    	<fileset dir="./yukon-client/lib"/>
	    </copy>

	   <property name="isshield" location="C:\Program Files\Macrovision\IS12\System\IsCmdBld.exe"/>
	   <property name="isfile" location='.\yukon-install\YukonSetupX\Yukon Installer.ism'/>
	   <exec failonerror="true" executable="${isshield}">
	   	<arg line="-p '${isfile}'"/>
	   </exec>		
	</target>
	
    <target name="cleandist" depends="init">
        <delete dir="./dist/"/>
    </target>

    <target name="builddist" depends="init">
        <copy todir="./temp/installer">
            <fileset dir="./yukon-install/YukonSetupX/Media/CD/Disk Images/Disk1"/>
        </copy>
        <copy todir="./temp/eSubImages">
            <fileset dir="./yukon-client/esub/images"/>
        </copy>
        <copy todir="./temp/YukonDatabase/DatabaseCreation">
            <fileset dir="./yukon-database/CreationScripts"/>
        </copy>
        <copy todir="./temp/YukonDatabase/DatabaseUpdates/Oracle">
            <fileset dir="./yukon-database/DBUpdates/oracle"/>
        </copy>
        <copy todir="./temp/YukonDatabase/DatabaseUpdates/SqlServer">
            <fileset dir="./yukon-database/DBUpdates/sqlserver"/>
        </copy>
        <mkdir dir="./dist"/>
     	<zip destfile="./dist/yukon_${tag.date}_${build.label}_${tag.time}.zip">
            <fileset dir="./temp"/>
        </zip>
        <delete dir="./temp"/>
    </target>	
	
<!--	
    <target name="buildquick" depends="update,build,runUnitTests,cleandist,builddist">
    </target>

    <target name="buildclean" depends="clean,checkout,build,signclient,runUnitTests,tag,cleandist,builddist">
    </target>



    <target name="checkout" depends="init,checktagdefined,checkouthead,checkouttag">
    </target>



    <target name="update" depends="init,checktagdefined,updatehead,updatetag">        
    </target>

    <target name="updatehead" unless="isyukontagdefined">
        <cvs dest="./yukon" command="update -A -d"/>        
    </target>

    <target name="updatetag" if="isyukontagdefined">
        <cvs dest="./yukon" command="update" tag="${yukon.tag}"/>
    </target>

    <target name="clean">
       <delete dir="./yukon"/>
    </target>

    
    <target name="build" depends="buildclient,buildserver,buildinstaller">
    </target>

    <target name="buildserver">
       <exec failonerror="true" dir="./yukon/yukon-server/" executable="cmd.exe">
           <arg line="/c buildhereexitAntBuild.cmd ${build.label}"/>
       </exec>               
    </target>

    <target name="buildclient">
       <exec failonerror="true" dir="./yukon/yukon-client/build" executable="cmd.exe">
           <arg line="/c antExit.bat -Dyukon.build.version=${build.label} build"/>
       </exec>       
    </target>

    <target name="signclient">
        <exec failonerror="true" dir="./yukon/yukon-client/build" executable="cmd.exe">
	   <arg line="/c antExit.bat sign"/>
       </exec>
    </target>

    <target name="runUnitTests">
       <exec failonerror="true" dir="./yukon/yukon-client/build" executable="cmd.exe">
           <arg line="/c antExit.bat -Dyukon.build.version=${build.label} runUnitTests"/>
       </exec>               
    </target>

    <target name="buildinstaller">
	<copy todir="c:/software/install/lib/server">
            <fileset dir="./yukon/yukon-server/bin" includes="*.exe,*.dll"/>
        </copy>

	<copy todir="c:/software/install/lib/client">
            <fileset dir="./yukon/yukon-client/lib"/>
        </copy>

        <property name="isshield" location="C:\Program Files\Macrovision\IS12\System\IsCmdBld.exe"/>
        <property name="isfile" location='.\yukon\yukon-install\YukonSetupX\Yukon Installer.ism'/>
        <exec failonerror="true" executable="${isshield}">
            <arg line="-p '${isfile}'"/>
        </exec>    
    </target>



    <target name="tag" depends="init">
        <cvs command="tag TG${tag.date}_${build.label}_${tag.time} ./yukon"/> 
    </target>

    <target name="branch" depends="init">
        <cvs command="tag -b BR${tag.date}_${build.label}_${tag.time} ./yukon"/>
    </target>

    <target name="fail">
      <fail/>
    </target>
 -->
</project>
