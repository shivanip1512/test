
#pragma warning( disable : 4786)

/*-----------------------------------------------------------------------------*
*
* File:   transdata_application
*
* Date:   7/22/2003
*
* Author: Eric Schmit
*
* PVCS KEYWORDS:
* ARCHIVE      :  $Archive$
* REVISION     :  $Revision: 1.1 $
* DATE         :  $Date: 2003/08/06 19:50:51 $
*
* Copyright (c) 1999, 2000, 2001, 2002 Cannon Technologies Inc. All rights reserved.
*-----------------------------------------------------------------------------*/

#include "transdata_application.h"

//=====================================================================================================================
//=====================================================================================================================

CtiTransdataApplication::CtiTransdataApplication()
{
   _lastState = 0;
}

//=====================================================================================================================
//=====================================================================================================================

CtiTransdataApplication::~CtiTransdataApplication()
{
}

//=====================================================================================================================
//=====================================================================================================================

bool CtiTransdataApplication::logOn( CtiXfer &xfer )
{
   getDataLinkLayer().logOn( xfer );

   return( true );
}

//=====================================================================================================================
//=====================================================================================================================

bool CtiTransdataApplication::logOff( CtiXfer &xfer )
{
   getDataLinkLayer().logOff( xfer );

   return( true );
}

//=====================================================================================================================
//=====================================================================================================================

bool CtiTransdataApplication::generate( CtiXfer &xfer )
{
   switch( _lastState )
   {
   case doLogOn:
      logOn( xfer );
      break;

   case doTalk:
      getDataLinkLayer().general( xfer );    //this should have other *things* it can do...
      break;

   case doLogOff:
      logOff( xfer );
      break;
   }

   return( true );
}

//=====================================================================================================================
//=====================================================================================================================

CtiTransdataDatalink &CtiTransdataApplication::getDataLinkLayer( void )
{
   return _datalinkLayer;
}

//=====================================================================================================================
//=====================================================================================================================

bool CtiTransdataApplication::isTransactionComplete( void )
{
   if( getDataLinkLayer().isTransactionComplete() )
   {
      return( true );
   }
   else
   {
      return( false );
   }
}

//=====================================================================================================================
//=====================================================================================================================

bool CtiTransdataApplication::decode( CtiXfer &xfer, int status )
{
   if( getDataLinkLayer().decode( xfer, status ))
   {
      getDataLinkLayer().retreiveData();
      setNextState();

      return( true );
   }
   else
   {
      return( false );
   }
}

//=====================================================================================================================
//=====================================================================================================================

void CtiTransdataApplication::injectData( RWCString str )
{
   getDataLinkLayer().injectData( str );
}

//=====================================================================================================================
//=====================================================================================================================

void CtiTransdataApplication::setNextState( void )
{
   if( _lastState == doLogOff )
      _lastState = doLogOn;
   else
      _lastState++;
}


